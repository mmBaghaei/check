import time
import requests
import asyncio
from telegram import Update
from telegram.ext import ApplicationBuilder, ContextTypes

TELEGRAM_TOKEN = '7867535139:AAE-dnosEQgvCR5UK-YyrEnNuSbh6LIs0Nw'
CHANNEL_ID = '@price_checker_doge'

def get_crypto_price():
    url = 'https://api.coingecko.com/api/v3/simple/price?ids=dogecoin&vs_currencies=usd'
    response = requests.get(url)
    data = response.json()
    return data['dogecoin']['usd']

async def send_price_to_channel(price: float):
    app = ApplicationBuilder().token(TELEGRAM_TOKEN).build()
    async with app:
        try:
            await app.bot.send_message(chat_id=CHANNEL_ID, text=f'قیمت دوج کوین : ${price}')
        except Exception as e:
            print(f"Error sending message: {e}")
            await asyncio.sleep(5)

async def main():
    while True:
        price = get_crypto_price()
        await send_price_to_channel(price)
        await asyncio.sleep(30)  # Increase to 60 seconds

if __name__ == '__main__':
    asyncio.run(main())
